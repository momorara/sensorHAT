ステップbyステップ

この説明では、完成品を使うのではなく、ご自身で調べて完成させて、
出来上がったときにはスキルが付いているって寸法の説明です。
そんなまどろっこしいことはやってられないって人は、どんどん先に進んでください。


ステップ-1
■ システムをインストール
buster Legacy か bullseyeをインストールしてください。
: Bullseyeでは不要なものもあります。
できれば、新品のSDカードにクリーンインストールしてください。
デスクトップが使えて、日本語やwifiが使えるようにしてください。
有線LANでもOKです。
ライブラリのインストールにはネットが必須です。

<<答え>>
ネットで「ラズパイ システムインストール」などと検索すればでてきますが、
今ですとオフィシャルの「Raspberry Pi Imager」を使うのが一番簡単です。
システムを入れたら次の設定をしましょう。
・sshを有効にする。
　$ sudo raspi-configとしてsshを有効化
・Google日本語入力の「Mozc」のパッケージをインストール
　$ sudo apt-get install ibus-mozc


ステップ-2
■データのダウンロード
リポジトリのsensorHATをダウンロード
git clone https://github.com/momorara/sensorHAT
として、プログラム等を入手してください。

■ node-redのインストール
今流行のノーコード、ローコードプログラミング環境です。GUI上で各種機能フローを繋ぐだけで
アプリを作ることが可能です。webアプリを作る方法は色々ありますが、
とりあえずスマホから操作できるwebアプリを作るのであれば、今のところnode-redが一番簡単だと思います。

https://nodered.org/docs/
↑
このページを参考にインストールしてください。
標準では入っていない次のパレットを追加してください。
　　node-red-contrib-calc
　　node-red-dashboard
・センサーui用のフローを読み込む
flows.json

<<答>>
node-redのインストール.pdf
<<参考>>
ラズパイ上で実施して、文字化けする場合は、windowsかMacのブラウザからnode-redの読み込みで
フロー(flows.json)を読み込んでみてください。


ステップ-3
■ 動作状況を理解する
node-redのuiを確認する。


ステップ-4
pythonプログラムを書いて、センサーを使えるようにする。
■ BMP180を使えるようにする
BMP180で検索すると使い方を書いたページが見つかるはずです。
それらのページを参考にBMP180のデータを読み込んで、気圧をファィルに書くプログラムを作ってください。
それを1分周期で行ってください。

■ AHT10を使えるようにする
AHT10で検索すると使い方を書いたページが見つかるはずです。
それらのページを参考にAHT10のデータを読み込んで、温度、湿度をファィルに書くプログラムを作ってください。
それを1分周期で行ってください。

■ SR-04を使えるようにする
SR-04は超音波で距離を測るセンサーです。
他のセンサーとは違い、これはフローからpythonプログラムを起動させ
その返り値を使っています。
SR-04については、ネットに情報がたくさんあるので、検索してみてください。


<<答>>
***SR04についてはsensorHATディレクトリのコピーのみで動作可能

***BMP180、AHT10についてはi2cの設定とライブラリのインストールが必要
sudo raspi-configでi2cを使用にする。
>>i2cデバイスとして認識されているか確認
i2cdetect -y 1
とすると認識されたi2c機器が番号で表示される
BMP180は77があればok
AHT10は38があればok

>>ライブラリのインストール
***BMP180
git clone https://github.com/adafruit/Adafruit_Python_BMP.git
cd Adafruit_Python_BMP
sudo python3 setup.py install
cd examples/
python3 simpletest.py
>>成功していれば、気圧が表示される。
***AHT10
pip install adafruit-circuitpython-ahtx0



答としてのプログラムは
git clone https://github.com/momorara/sensorHAT
とすれば、piの直下にsensorHATが作られ、その中にプログラムがあります。
既にsensorHATを作っている場合は、フォルダの名前を変えるなどして、退避しておいてください。

sensorHATの中に crontab というファィルがあります。
cronでの設定が書かれていますので、このまま設定すれば、ラズパイの電源を入れれば、
センサーを計測できる状態で立ち上がるはずです。

BMP180、AHT10それぞれのプログラムを定期的に呼びだす仕組みになっています。
必要なモノだけ # を外して生かしてください。





